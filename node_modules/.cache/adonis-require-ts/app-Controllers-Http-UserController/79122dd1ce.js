"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
const CreditCard_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/CreditCard"));
const Address_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Address"));
const Role_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Role"));
const Restorer_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Restorer"));
class UsersController {
    async index({ response }) {
        try {
            const users = await User_1.default.query()
                .preload('role')
                .preload('credit_card')
                .preload('delivery_address_id')
                .preload('payement_address_id')
                .preload('restorer');
            return response.status(200).json({ users });
        }
        catch (err) {
        }
    }
    async getById({ params, response }) {
        try {
            const user = await User_1.default.findOrFail(params.id);
            return response.status(200).json({ user });
        }
        catch (err) {
            return response.json({ err });
        }
    }
    async createClient({ request, response }) {
        try {
            const user = await User_1.default.create({ user_firstname: request.body()['user_firstname'], user_lastname: request.body()['user_lastname'], user_email: request.body()['user_email'], user_password: request.body()['user_password'], user_phone_number: request.body()['user_phone_number'], user_is_supported: request.body()['user_is_supported'], user_support: request.body()['user_support'], user_is_delivery: false });
            if (request.body()['delivery_address_city'] != undefined && request.body()['delivery_address_street'] != undefined && request.body()['delivery_address_postal_code'] != undefined && request.body()['delivery_address_street_number'] != undefined) {
                const delivery_address = await Address_1.default.create({ address_city: request.body()['delivery_address_city'], address_street: request.body()['delivery_address_street'], address_street_number: request.body()['delivery_address_street_number'], address_postal_code: request.body()['delivery_address_postal_code'] });
                await user.related('delivery_address_id').associate(delivery_address);
            }
            if (request.body()['payment_address_city'] != undefined && request.body()['payment_address_street'] != undefined && request.body()['payment_address_postal_code'] != undefined && request.body()['payment_address_street_number'] != undefined) {
                const payment_address = await Address_1.default.create({ address_city: request.body()['payment_address_city'], address_street: request.body()['payment_address_street'], address_street_number: request.body()['payment_address_street_number'], address_postal_code: request.body()['payment_address_postal_code'] });
                await user.related('payement_address_id').associate(payment_address);
            }
            if (request.body()['credit_card_type'] != undefined && request.body()['credit_card_num'] != undefined) {
                const creditcard = await CreditCard_1.default.create({ credit_card_type: request.body()['credit_card_type'], credit_card_num: request.body()['credit_card_num'] });
                await user.related('credit_card').associate(creditcard);
            }
            const role = await Role_1.default.findOrFail(1);
            await user.related('role').associate(role);
            return response.status(201).json({ user });
        }
        catch (err) {
            return response.json({ err });
        }
    }
    async createDelivery({ request, response }) {
        try {
            const user = await User_1.default.create({ user_firstname: request.body()['user_firstname'], user_lastname: request.body()['user_lastname'], user_email: request.body()['user_email'], user_password: request.body()['user_password'], user_phone_number: request.body()['user_phone_number'], user_is_supported: request.body()['user_is_supported'], user_support: request.body()['user_support'], user_is_delivery: true });
            const role = await Role_1.default.findOrFail(2);
            await user.related('role').associate(role);
            return response.status(201).json({ user });
        }
        catch (err) {
            return response.status(500).json({ err });
        }
    }
    async createRestorer({ request, response }) {
        try {
            const user = await User_1.default.create({ user_firstname: request.body()['user_firstname'], user_lastname: request.body()['user_lastname'], user_email: request.body()['user_email'], user_password: request.body()['user_password'], user_phone_number: request.body()['user_phone_number'], user_is_supported: request.body()['user_is_supported'], user_support: request.body()['user_support'], user_is_delivery: false });
            const role = await Role_1.default.findOrFail(3);
            await user.related('role').associate(role);
            const restorer = await Restorer_1.default.create(request.body()['restorer_name']);
            const address = await Address_1.default.create({ address_city: request.body()['restorer_address_city'], address_street: request.body()['restorer_address_street'], address_street_number: request.body()['restorer_address_street_number'], address_postal_code: request.body()['restorer_address_postal_code'] });
            await restorer.related('address').associate(address);
            await user.related('restorer').associate(restorer);
            return response.status(201).json({ user });
        }
        catch (err) {
            return response.status(500).json({ err });
        }
    }
    async update({ request, response, params }) {
        try {
            const user = await User_1.default.findOrFail(params.id);
            if (request.body()['user_support'] !== false && request.body()['user_is_supported'] !== false) {
                user.merge({ user_firstname: request.body()['user_firstname'], user_lastname: request.body()['user_lastname'], user_email: request.body()['user_email'], user_password: request.body()['user_password'], user_phone_number: request.body()['user_phone_number'], user_is_supported: request.body()['user_is_supported'], user_support: request.body()['user_support'] });
                await user.save();
                return response.status(200).json({ user });
            }
            else {
                return response.status(403).json({ message: "once true you can't change your support state" });
            }
        }
        catch (err) {
            return response.status(500).json({ err });
        }
    }
    async delete({ response, params }) {
        try {
            const user = await User_1.default.findOrFail(params.id);
            await user.delete();
            return response.status(200).json({ user });
        }
        catch (err) {
        }
    }
}
exports.default = UsersController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlckNvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVc2VyQ29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLGlGQUFrQztBQUNsQyw2RkFBOEM7QUFDOUMsdUZBQXdDO0FBQ3hDLGlGQUFrQztBQUNsQyx5RkFBMEM7QUFJMUMsTUFBcUIsZUFBZTtJQUV6QixLQUFLLENBQUMsS0FBSyxDQUFFLEVBQUMsUUFBUSxFQUFxQjtRQUM5QyxJQUFHO1lBQ0MsTUFBTSxLQUFLLEdBQUcsTUFBTSxjQUFJLENBQUMsS0FBSyxFQUFFO2lCQUMvQixPQUFPLENBQUMsTUFBTSxDQUFDO2lCQUNmLE9BQU8sQ0FBQyxhQUFhLENBQUM7aUJBQ3RCLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQztpQkFDOUIsT0FBTyxDQUFDLHFCQUFxQixDQUFDO2lCQUM5QixPQUFPLENBQUMsVUFBVSxDQUFDLENBQUE7WUFDcEIsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBQyxDQUFDLENBQUE7U0FDNUM7UUFBQSxPQUFNLEdBQUcsRUFBQztTQUVWO0lBRUwsQ0FBQztJQUVNLEtBQUssQ0FBQyxPQUFPLENBQUUsRUFBQyxNQUFNLEVBQUMsUUFBUSxFQUFxQjtRQUN2RCxJQUFHO1lBQ0MsTUFBTSxJQUFJLEdBQUcsTUFBTSxjQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM5QyxPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFDLENBQUMsQ0FBQTtTQUMzQztRQUFBLE9BQU0sR0FBRyxFQUFDO1lBQ1AsT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsR0FBRyxFQUFDLENBQUMsQ0FBQTtTQUM5QjtJQUVMLENBQUM7SUFFTSxLQUFLLENBQUMsWUFBWSxDQUFDLEVBQUUs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QU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxHQUFHLEVBQUMsQ0FBQyxDQUFBO1NBQzFDO0lBRUwsQ0FBQztJQUVNLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBQyxRQUFRLEVBQUUsTUFBTSxFQUFxQjtRQUN0RCxJQUFHO1lBQ0MsTUFBTSxJQUFJLEdBQUcsTUFBTSxjQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM5QyxNQUFNLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNwQixPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFDLENBQUMsQ0FBQTtTQUMzQztRQUFBLE9BQU0sR0FBRyxFQUFDO1NBRVY7SUFFTCxDQUFDO0NBRUo7QUFoSEQsa0NBZ0hDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENvbnRleHRDb250cmFjdCB9IGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvSHR0cENvbnRleHQnXG5pbXBvcnQgVXNlciBmcm9tICdBcHAvTW9kZWxzL1VzZXInXG5pbXBvcnQgQ3JlZGl0Q2FyZCBmcm9tICdBcHAvTW9kZWxzL0NyZWRpdENhcmQnXG5pbXBvcnQgQWRkcmVzcyBmcm9tICdBcHAvTW9kZWxzL0FkZHJlc3MnXG5pbXBvcnQgUm9sZSBmcm9tICdBcHAvTW9kZWxzL1JvbGUnXG5pbXBvcnQgUmVzdG9yZXIgZnJvbSAnQXBwL01vZGVscy9SZXN0b3JlcidcbmltcG9ydCB7IGFkZCB9IGZyb20gJ3dpbnN0b24nXG5cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlcnNDb250cm9sbGVyIHtcblxuICAgIHB1YmxpYyBhc3luYyBpbmRleCAoe3Jlc3BvbnNlfTpIdHRwQ29udGV4dENvbnRyYWN0KXtcbiAgICAgICAgdHJ5e1xuICAgICAgICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCBVc2VyLnF1ZXJ5KClcbiAgICAgICAgICAgIC5wcmVsb2FkKCdyb2xlJylcbiAgICAgICAgICAgIC5wcmVsb2FkKCdjcmVkaXRfY2FyZCcpXG4gICAgICAgICAgICAucHJlbG9hZCgnZGVsaXZlcnlfYWRkcmVzc19pZCcpXG4gICAgICAgICAgICAucHJlbG9hZCgncGF5ZW1lbnRfYWRkcmVzc19pZCcpXG4gICAgICAgICAgICAucHJlbG9hZCgncmVzdG9yZXInKVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24oe3VzZXJzfSlcbiAgICAgICAgfWNhdGNoKGVycil7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldEJ5SWQgKHtwYXJhbXMscmVzcG9uc2V9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xuICAgICAgICB0cnl7XG4gICAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT3JGYWlsKHBhcmFtcy5pZCk7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMCkuanNvbih7dXNlcn0pXG4gICAgICAgIH1jYXRjaChlcnIpe1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oe2Vycn0pXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBjcmVhdGVDbGllbnQoeyByZXF1ZXN0ICwgcmVzcG9uc2UgfTpIdHRwQ29udGV4dENvbnRyYWN0KXtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuY3JlYXRlKHt1c2VyX2ZpcnN0bmFtZTpyZXF1ZXN0LmJvZHkoKVsndXNlcl9maXJzdG5hbWUnXSx1c2VyX2xhc3RuYW1lOnJlcXVlc3QuYm9keSgpWyd1c2VyX2xhc3RuYW1lJ10sdXNlcl9lbWFpbDpyZXF1ZXN0LmJvZHkoKVsndXNlcl9lbWFpbCddLHVzZXJfcGFzc3dvcmQ6cmVxdWVzdC5ib2R5KClbJ3VzZXJfcGFzc3dvcmQnXSx1c2VyX3Bob25lX251bWJlcjpyZXF1ZXN0LmJvZHkoKVsndXNlcl9waG9uZV9udW1iZXInXSwgdXNlcl9pc19zdXBwb3J0ZWQ6cmVxdWVzdC5ib2R5KClbJ3VzZXJfaXNfc3VwcG9ydGVkJ10sdXNlcl9zdXBwb3J0OnJlcXVlc3QuYm9keSgpWyd1c2VyX3N1cHBvcnQnXSx1c2VyX2lzX2RlbGl2ZXJ5OmZhbHNlfSk7XG5cbiAgICAgICAgICAgIGlmIChyZXF1ZXN0LmJvZHkoKVsnZGVsaXZlcnlfYWRkcmVzc19jaXR5J10hPSB1bmRlZmluZWQgJiYgcmVxdWVzdC5ib2R5KClbJ2RlbGl2ZXJ5X2FkZHJlc3Nfc3RyZWV0J10hPSB1bmRlZmluZWQgJiYgcmVxdWVzdC5ib2R5KClbJ2RlbGl2ZXJ5X2FkZHJlc3NfcG9zdGFsX2NvZGUnXSE9IHVuZGVmaW5lZCAmJiByZXF1ZXN0LmJvZHkoKVsnZGVsaXZlcnlfYWRkcmVzc19zdHJlZXRfbnVtYmVyJ10hPSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlbGl2ZXJ5X2FkZHJlc3MgPSBhd2FpdCBBZGRyZXNzLmNyZWF0ZSh7YWRkcmVzc19jaXR5OiByZXF1ZXN0LmJvZHkoKVsnZGVsaXZlcnlfYWRkcmVzc19jaXR5J10sIGFkZHJlc3Nfc3RyZWV0OiByZXF1ZXN0LmJvZHkoKVsnZGVsaXZlcnlfYWRkcmVzc19zdHJlZXQnXSwgYWRkcmVzc19zdHJlZXRfbnVtYmVyOiByZXF1ZXN0LmJvZHkoKVsnZGVsaXZlcnlfYWRkcmVzc19zdHJlZXRfbnVtYmVyJ10sIGFkZHJlc3NfcG9zdGFsX2NvZGU6cmVxdWVzdC5ib2R5KClbJ2RlbGl2ZXJ5X2FkZHJlc3NfcG9zdGFsX2NvZGUnXSB9KTtcbiAgICAgICAgICAgICAgICBhd2FpdCB1c2VyLnJlbGF0ZWQoJ2RlbGl2ZXJ5X2FkZHJlc3NfaWQnKS5hc3NvY2lhdGUoZGVsaXZlcnlfYWRkcmVzcylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXF1ZXN0LmJvZHkoKVsncGF5bWVudF9hZGRyZXNzX2NpdHknXSE9IHVuZGVmaW5lZCAmJiByZXF1ZXN0LmJvZHkoKVsncGF5bWVudF9hZGRyZXNzX3N0cmVldCddIT0gdW5kZWZpbmVkICYmIHJlcXVlc3QuYm9keSgpWydwYXltZW50X2FkZHJlc3NfcG9zdGFsX2NvZGUnXSE9IHVuZGVmaW5lZCAmJiByZXF1ZXN0LmJvZHkoKVsncGF5bWVudF9hZGRyZXNzX3N0cmVldF9udW1iZXInXSE9IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgY29uc3QgcGF5bWVudF9hZGRyZXNzID0gYXdhaXQgQWRkcmVzcy5jcmVhdGUoe2FkZHJlc3NfY2l0eTogcmVxdWVzdC5ib2R5KClbJ3BheW1lbnRfYWRkcmVzc19jaXR5J10sIGFkZHJlc3Nfc3RyZWV0OiByZXF1ZXN0LmJvZHkoKVsncGF5bWVudF9hZGRyZXNzX3N0cmVldCddLCBhZGRyZXNzX3N0cmVldF9udW1iZXI6IHJlcXVlc3QuYm9keSgpWydwYXltZW50X2FkZHJlc3Nfc3RyZWV0X251bWJlciddLCBhZGRyZXNzX3Bvc3RhbF9jb2RlOnJlcXVlc3QuYm9keSgpWydwYXltZW50X2FkZHJlc3NfcG9zdGFsX2NvZGUnXSB9KTtcbiAgICAgICAgICAgICAgICBhd2FpdCB1c2VyLnJlbGF0ZWQoJ3BheWVtZW50X2FkZHJlc3NfaWQnKS5hc3NvY2lhdGUocGF5bWVudF9hZGRyZXNzKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlcXVlc3QuYm9keSgpWydjcmVkaXRfY2FyZF90eXBlJ10hPXVuZGVmaW5lZCAmJiByZXF1ZXN0LmJvZHkoKVsnY3JlZGl0X2NhcmRfbnVtJ10hPXVuZGVmaW5lZCApe1xuICAgICAgICAgICAgICAgIGNvbnN0IGNyZWRpdGNhcmQgPSBhd2FpdCBDcmVkaXRDYXJkLmNyZWF0ZSh7Y3JlZGl0X2NhcmRfdHlwZTogcmVxdWVzdC5ib2R5KClbJ2NyZWRpdF9jYXJkX3R5cGUnXSwgY3JlZGl0X2NhcmRfbnVtIDogcmVxdWVzdC5ib2R5KClbJ2NyZWRpdF9jYXJkX251bSddIH0pO1xuICAgICAgICAgICAgICAgIGF3YWl0IHVzZXIucmVsYXRlZCgnY3JlZGl0X2NhcmQnKS5hc3NvY2lhdGUoY3JlZGl0Y2FyZClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJvbGUgPSBhd2FpdCBSb2xlLmZpbmRPckZhaWwoMSlcbiAgICAgICAgICAgIGF3YWl0IHVzZXIucmVsYXRlZCgncm9sZScpLmFzc29jaWF0ZShyb2xlKVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDEpLmpzb24oe3VzZXJ9KVxuICAgICAgICB9Y2F0Y2goZXJyKXtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKHtlcnJ9KVxuICAgICAgICB9XG5cblxuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBjcmVhdGVEZWxpdmVyeSh7IHJlcXVlc3QgLCByZXNwb25zZSB9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuY3JlYXRlKHt1c2VyX2ZpcnN0bmFtZTpyZXF1ZXN0LmJvZHkoKVsndXNlcl9maXJzdG5hbWUnXSx1c2VyX2xhc3RuYW1lOnJlcXVlc3QuYm9keSgpWyd1c2VyX2xhc3RuYW1lJ10sdXNlcl9lbWFpbDpyZXF1ZXN0LmJvZHkoKVsndXNlcl9lbWFpbCddLHVzZXJfcGFzc3dvcmQ6cmVxdWVzdC5ib2R5KClbJ3VzZXJfcGFzc3dvcmQnXSx1c2VyX3Bob25lX251bWJlcjpyZXF1ZXN0LmJvZHkoKVsndXNlcl9waG9uZV9udW1iZXInXSwgdXNlcl9pc19zdXBwb3J0ZWQ6cmVxdWVzdC5ib2R5KClbJ3VzZXJfaXNfc3VwcG9ydGVkJ10sdXNlcl9zdXBwb3J0OnJlcXVlc3QuYm9keSgpWyd1c2VyX3N1cHBvcnQnXSx1c2VyX2lzX2RlbGl2ZXJ5OnRydWV9KTtcbiAgICAgICAgICAgIGNvbnN0IHJvbGUgPSBhd2FpdCBSb2xlLmZpbmRPckZhaWwoMilcbiAgICAgICAgICAgIGF3YWl0IHVzZXIucmVsYXRlZCgncm9sZScpLmFzc29jaWF0ZShyb2xlKVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDEpLmpzb24oe3VzZXJ9KVxuXG4gICAgICAgIH1jYXRjaChlcnIpe1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg1MDApLmpzb24oe2Vycn0pXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBjcmVhdGVSZXN0b3Jlcih7IHJlcXVlc3QgLCByZXNwb25zZSB9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuY3JlYXRlKHt1c2VyX2ZpcnN0bmFtZTpyZXF1ZXN0LmJvZHkoKVsndXNlcl9maXJzdG5hbWUnXSx1c2VyX2xhc3RuYW1lOnJlcXVlc3QuYm9keSgpWyd1c2VyX2xhc3RuYW1lJ10sdXNlcl9lbWFpbDpyZXF1ZXN0LmJvZHkoKVsndXNlcl9lbWFpbCddLHVzZXJfcGFzc3dvcmQ6cmVxdWVzdC5ib2R5KClbJ3VzZXJfcGFzc3dvcmQnXSx1c2VyX3Bob25lX251bWJlcjpyZXF1ZXN0LmJvZHkoKVsndXNlcl9waG9uZV9udW1iZXInXSwgdXNlcl9pc19zdXBwb3J0ZWQ6cmVxdWVzdC5ib2R5KClbJ3VzZXJfaXNfc3VwcG9ydGVkJ10sdXNlcl9zdXBwb3J0OnJlcXVlc3QuYm9keSgpWyd1c2VyX3N1cHBvcnQnXSx1c2VyX2lzX2RlbGl2ZXJ5OmZhbHNlfSk7XG4gICAgICAgICAgICBjb25zdCByb2xlID0gYXdhaXQgUm9sZS5maW5kT3JGYWlsKDMpXG4gICAgICAgICAgICBhd2FpdCB1c2VyLnJlbGF0ZWQoJ3JvbGUnKS5hc3NvY2lhdGUocm9sZSlcbiAgICAgICAgICAgIGNvbnN0IHJlc3RvcmVyID0gYXdhaXQgUmVzdG9yZXIuY3JlYXRlKHJlcXVlc3QuYm9keSgpWydyZXN0b3Jlcl9uYW1lJ10pXG4gICAgICAgICAgICBjb25zdCBhZGRyZXNzID0gYXdhaXQgQWRkcmVzcy5jcmVhdGUoe2FkZHJlc3NfY2l0eTogcmVxdWVzdC5ib2R5KClbJ3Jlc3RvcmVyX2FkZHJlc3NfY2l0eSddLCBhZGRyZXNzX3N0cmVldDogcmVxdWVzdC5ib2R5KClbJ3Jlc3RvcmVyX2FkZHJlc3Nfc3RyZWV0J10sIGFkZHJlc3Nfc3RyZWV0X251bWJlcjogcmVxdWVzdC5ib2R5KClbJ3Jlc3RvcmVyX2FkZHJlc3Nfc3RyZWV0X251bWJlciddLCBhZGRyZXNzX3Bvc3RhbF9jb2RlOnJlcXVlc3QuYm9keSgpWydyZXN0b3Jlcl9hZGRyZXNzX3Bvc3RhbF9jb2RlJ10gfSlcbiAgICAgICAgICAgIGF3YWl0IHJlc3RvcmVyLnJlbGF0ZWQoJ2FkZHJlc3MnKS5hc3NvY2lhdGUoYWRkcmVzcylcbiAgICAgICAgICAgIGF3YWl0IHVzZXIucmVsYXRlZCgncmVzdG9yZXInKS5hc3NvY2lhdGUocmVzdG9yZXIpXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMSkuanNvbih7dXNlcn0pXG5cbiAgICAgICAgfWNhdGNoKGVycil7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMCkuanNvbih7ZXJyfSlcbiAgICAgICAgfVxuXG4gICAgfVxuXG5cbiAgICBwdWJsaWMgYXN5bmMgdXBkYXRlICh7cmVxdWVzdCwgcmVzcG9uc2UsIHBhcmFtc306SHR0cENvbnRleHRDb250cmFjdCl7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT3JGYWlsKHBhcmFtcy5pZCk7XG4gICAgICAgICAgICBpZiAocmVxdWVzdC5ib2R5KClbJ3VzZXJfc3VwcG9ydCddIT09IGZhbHNlICYmIHJlcXVlc3QuYm9keSgpWyd1c2VyX2lzX3N1cHBvcnRlZCddIT09ZmFsc2Upe1xuICAgICAgICAgICAgICAgIHVzZXIubWVyZ2Uoe3VzZXJfZmlyc3RuYW1lOnJlcXVlc3QuYm9keSgpWyd1c2VyX2ZpcnN0bmFtZSddLHVzZXJfbGFzdG5hbWU6cmVxdWVzdC5ib2R5KClbJ3VzZXJfbGFzdG5hbWUnXSx1c2VyX2VtYWlsOnJlcXVlc3QuYm9keSgpWyd1c2VyX2VtYWlsJ10sdXNlcl9wYXNzd29yZDpyZXF1ZXN0LmJvZHkoKVsndXNlcl9wYXNzd29yZCddLHVzZXJfcGhvbmVfbnVtYmVyOnJlcXVlc3QuYm9keSgpWyd1c2VyX3Bob25lX251bWJlciddLCB1c2VyX2lzX3N1cHBvcnRlZDpyZXF1ZXN0LmJvZHkoKVsndXNlcl9pc19zdXBwb3J0ZWQnXSx1c2VyX3N1cHBvcnQ6cmVxdWVzdC5ib2R5KClbJ3VzZXJfc3VwcG9ydCddfSk7XG4gICAgICAgICAgICAgICAgYXdhaXQgdXNlci5zYXZlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24oe3VzZXJ9KVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MDMpLmpzb24oe21lc3NhZ2U6IFwib25jZSB0cnVlIHlvdSBjYW4ndCBjaGFuZ2UgeW91ciBzdXBwb3J0IHN0YXRlXCJ9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9Y2F0Y2goZXJyKXtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAwKS5qc29uKHtlcnJ9KVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZGVsZXRlKHtyZXNwb25zZSwgcGFyYW1zfTpIdHRwQ29udGV4dENvbnRyYWN0KXtcbiAgICAgICAgdHJ5e1xuICAgICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZE9yRmFpbChwYXJhbXMuaWQpO1xuICAgICAgICAgICAgYXdhaXQgdXNlci5kZWxldGUoKTtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5qc29uKHt1c2VyfSlcbiAgICAgICAgfWNhdGNoKGVycil7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59XG4iXX0=