"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Command_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Command"));
const jsonwebtoken_1 = __importDefault(require("jsonwebtoken"));
class CommandsController {
    async getCommand({ request, response }) {
        try {
            return await Command_1.default.findOne({ _id: request.input('command_id') });
        }
        catch (err) {
            return response.status(502);
        }
    }
    async createCommand({ request, response }) {
        try {
            await Command_1.default.create(request.body());
            return response.ok("Command created");
        }
        catch (err) {
            return response.status(502);
        }
    }
    async editCommand({ request, response }) {
        try {
            await Command_1.default.updateOne({ _id: request.input('command_id') }, request.body());
            return response.ok("Command edited");
        }
        catch (err) {
            return response.status(502);
        }
    }
    async deleteCommand({ request, response }) {
        try {
            await Command_1.default.deleteOne({ _id: request.input('command_id') });
            return response.ok("Command deleted");
        }
        catch (err) {
            return response.status(502);
        }
    }
    async payCommand({ request, response }) {
        try {
            await Command_1.default.updateOne({ _id: request.input('command_id') }, { paid: true });
            return response.ok("Command paid");
        }
        catch (err) {
            return response.status(502);
        }
    }
    async validateCommand({ request, response }) {
        try {
            await Command_1.default.updateOne({ _id: request.input('command_id') }, { "info.validated": true });
            return response.ok("Command validated");
        }
        catch (err) {
            return response.status(502);
        }
    }
    async getHistoricCommand({ request, response }) {
        try {
            const token = request.header('authorization').split(" ");
            const user_id = jsonwebtoken_1.default.verify(token[1], "TOKEN_PRIVATE_KEY").user_id;
            return response.send(await Command_1.default.find({ 'info.client.user_id': user_id }));
        }
        catch (err) {
            return response.status(502);
        }
    }
    async getCommands({ response }) {
        try {
            return response.send(await Command_1.default.find());
        }
        catch (err) {
            return response.status(502);
        }
    }
    async getCommandsByRestorer({ request, response }) {
        try {
            const restorer_id = request.input('restorer_id');
            return response.send(await Command_1.default.find({ 'info.restorer_id': restorer_id }));
        }
        catch (err) {
            return response.status(502);
        }
    }
    async deleteHistoricCommand({ request, response }) {
        try {
            await Command_1.default.deleteMany({ _id: { $in: request.body().delete_historic } });
            return response.ok("Commands deleted");
        }
        catch (err) {
            return response.status(502);
        }
    }
}
exports.default = CommandsController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tbWFuZHNDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ29tbWFuZHNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsdUZBQXlDO0FBQ3pDLGdFQUE4QjtBQUc5QixNQUFxQixrQkFBa0I7SUFXNUIsS0FBSyxDQUFDLFVBQVUsQ0FBRSxFQUFDLE9BQU8sRUFBRSxRQUFRLEVBQXFCO1FBQzVELElBQUk7WUFDQSxPQUFPLE1BQU0saUJBQU8sQ0FBQyxPQUFPLENBQUMsRUFBQyxHQUFHLEVBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsRUFBQyxDQUFDLENBQUE7U0FDbEU7UUFBQSxPQUFNLEdBQUcsRUFBQztZQUNQLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtTQUM5QjtJQUNMLENBQUM7SUFXTSxLQUFLLENBQUMsYUFBYSxDQUFFLEVBQUMsT0FBTyxFQUFFLFFBQVEsRUFBcUI7UUFDL0QsSUFBRztZQUNDLE1BQU0saUJBQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7WUFDcEMsT0FBTyxRQUFRLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFDLENBQUE7U0FDeEM7UUFBQSxPQUFNLEdBQUcsRUFBQztZQUNQLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtTQUM5QjtJQUVMLENBQUM7SUFZTSxLQUFLLENBQUMsV0FBVyxDQUFFLEVBQUMsT0FBTyxFQUFFLFFBQVEsRUFBcUI7UUFDN0QsSUFBRztZQUNDLE1BQU0saUJBQU8sQ0FBQyxTQUFTLENBQUMsRUFBQyxHQUFHLEVBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsRUFBQyxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBO1lBQzFFLE9BQU8sUUFBUSxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO1NB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LElBQUksQ0FBQyxFQUFDLGtCQUFrQixFQUFDLFdBQVcsRUFBQyxDQUFDLENBQUMsQ0FBQTtTQUM3RTtRQUFBLE9BQU0sR0FBRyxFQUFDO1lBQ1AsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1NBQzlCO0lBQ0wsQ0FBQztJQVdNLEtBQUssQ0FBQyxxQkFBcUIsQ0FBRSxFQUFDLE9BQU8sRUFBRSxRQUFRLEVBQXFCO1FBQ3ZFLElBQUc7WUFDQyxNQUFNLGlCQUFPLENBQUMsVUFBVSxDQUFDLEVBQUMsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxlQUFlLEVBQUMsRUFBQyxDQUFDLENBQUE7WUFDdkUsT0FBTyxRQUFRLENBQUMsRUFBRSxDQUFDLGtCQUFrQixDQUFDLENBQUE7U0FDekM7UUFBQSxPQUFNLEdBQUcsRUFBQztZQUNQLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtTQUM5QjtJQUVMLENBQUM7Q0FDSjtBQTVLRCxxQ0E0S0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ29udGV4dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcclxuaW1wb3J0IENvbW1hbmQgZnJvbSBcIkFwcC9Nb2RlbHMvQ29tbWFuZFwiO1xyXG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbidcclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21tYW5kc0NvbnRyb2xsZXIge1xyXG5cclxuXHJcbiAgICAvKiogXHJcbiAgICAgKiBAYXBpIHtnZXR9IC9jb21tYW5kIFJlcXVlc3QgY29tbWFuZCBpbmZvcm1hdGlvbi5cclxuICAgICAqIEBhcGlOYW1lIGdldENvbW1hbmRcclxuICAgICAqIEBhcGlncm91cCBDb21tYW5kXHJcbiAgICAgKiBAYXBpUGFyYW0ge1N0cmluZ30gY29tbWFuZF9pZCBJZCBvZiBjb21tYW5kLlxyXG4gICAgICogQGFwaVN1Y2Nlc3Mge09iamVjdH0gY29tbWFuZCBDb21tYW5kIGluZm9ybWF0aW9uIGZvdW5kLlxyXG4gICAgICogQGFwaUVycm9yICg1MDIpIEVycm9yIEVycm9yIHRvIHJlcXVlc3QgZGF0YWJhc2UuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhc3luYyBnZXRDb21tYW5kICh7cmVxdWVzdCwgcmVzcG9uc2V9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xyXG4gICAgICAgIHRyeSB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBDb21tYW5kLmZpbmRPbmUoe19pZDpyZXF1ZXN0LmlucHV0KCdjb21tYW5kX2lkJyl9KVxyXG4gICAgICAgIH1jYXRjaChlcnIpe1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMilcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAYXBpIHtwb3N0fSAvY29tbWFuZCBDcmVhdGUgYSBuZXcgQ29tbWFuZC5cclxuICAgICAqIEBhcGlOYW1lIGNyZWF0ZUNvbW1hbmRcclxuICAgICAqIEBhcGlHcm91cCBDb21tYW5kXHJcbiAgICAgKiBAYXBpUGFyYW0gKEF1dGhvcml6YXRpb24pe1N0cmluZ30gQmVhcmVyIFRva2VuIHZhbHVlIGluIGF1dGhvcmlzYXRpb24gQmVhcmVyLlxyXG4gICAgICogQGFwaVBhcmFtIChCb2R5KSB7T2JqZWN0fSBjb21tYW5kIENvbW1hbmQgb2JqZWN0LlxyXG4gICAgICogQGFwaVN1Y2Nlc3MgcmVzcG9uc2UgQ29tbWFuZCBjcmVhdGVkLlxyXG4gICAgICogQGFwaUVycm9yICg1MDIpIEVycm9yIEVycm9yIHRvIHJlcXVlc3QgZGF0YWJhc2UuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhc3luYyBjcmVhdGVDb21tYW5kICh7cmVxdWVzdCwgcmVzcG9uc2V9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xyXG4gICAgICAgIHRyeXtcclxuICAgICAgICAgICAgYXdhaXQgQ29tbWFuZC5jcmVhdGUocmVxdWVzdC5ib2R5KCkpXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5vayhcIkNvbW1hbmQgY3JlYXRlZFwiKVxyXG4gICAgICAgIH1jYXRjaChlcnIpe1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMilcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIEBhcGkge3B1dH0gL2NvbW1hbmQgRWRpdCBhIENvbW1hbmQuXHJcbiAgICAgKiBAYXBpTmFtZSBlZGl0Q29tbWFuZFxyXG4gICAgICogQGFwaUdyb3VwIENvbW1hbmRcclxuICAgICAqIEBhcGlQYXJhbSB7U3RyaW5nfSBjb21tYW5kX2lkIElkIG9mIGNvbW1hbmQuXHJcbiAgICAgKiBAYXBpUGFyYW0gKEF1dGhvcml6YXRpb24pe1N0cmluZ30gQmVhcmVyIFRva2VuIHZhbHVlIGluIGF1dGhvcmlzYXRpb24gQmVhcmVyLlxyXG4gICAgICogQGFwaVBhcmFtIChCb2R5KSB7T2JqZWN0fSBjb21tYW5kIENvbW1hbmQgb2JqZWN0LlxyXG4gICAgICogQGFwaVN1Y2Nlc3MgcmVzcG9uc2UgQ29tbWFuZCBlZGl0ZWQuXHJcbiAgICAgKiBAYXBpRXJyb3IgKDUwMikgRXJyb3IgRXJyb3IgdG8gcmVxdWVzdCBkYXRhYmFzZS5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGFzeW5jIGVkaXRDb21tYW5kICh7cmVxdWVzdCwgcmVzcG9uc2V9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xyXG4gICAgICAgIHRyeXtcclxuICAgICAgICAgICAgYXdhaXQgQ29tbWFuZC51cGRhdGVPbmUoe19pZDpyZXF1ZXN0LmlucHV0KCdjb21tYW5kX2lkJyl9LCByZXF1ZXN0LmJvZHkoKSlcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKFwiQ29tbWFuZCBlZGl0ZWRcIikgICBcclxuICAgICAgICB9Y2F0Y2goZXJyKXtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg1MDIpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGFwaSB7ZGVsZXRlfSAvY29tbWFuZCBEZWxldGUgYSBDb21tYW5kLlxyXG4gICAgICogQGFwaU5hbWUgZGVsZXRlQ29tbWFuZFxyXG4gICAgICogQGFwaUdyb3VwIENvbW1hbmRcclxuICAgICAqIEBhcGlQYXJhbSB7U3RyaW5nfSBjb21tYW5kX2lkIElkIG9mIGNvbW1hbmQuXHJcbiAgICAgKiBAYXBpUGFyYW0gKEF1dGhvcml6YXRpb24pe1N0cmluZ30gQmVhcmVyIFRva2VuIHZhbHVlIGluIGF1dGhvcmlzYXRpb24gQmVhcmVyLlxyXG4gICAgICogQGFwaVN1Y2Nlc3MgcmVzcG9uc2UgQ29tbWFuZCBkZWxldGVkLlxyXG4gICAgICogQGFwaUVycm9yICg1MDIpIEVycm9yIEVycm9yIHRvIHJlcXVlc3QgZGF0YWJhc2UuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhc3luYyBkZWxldGVDb21tYW5kICh7cmVxdWVzdCwgcmVzcG9uc2V9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xyXG4gICAgICAgIHRyeXtcclxuICAgICAgICAgICAgYXdhaXQgQ29tbWFuZC5kZWxldGVPbmUoe19pZDpyZXF1ZXN0LmlucHV0KCdjb21tYW5kX2lkJyl9KVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2soXCJDb21tYW5kIGRlbGV0ZWRcIikgIFxyXG4gICAgICAgIH1jYXRjaChlcnIpe1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMilcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAYXBpIHtwYXRjaH0gL3BheSBQYXkgYSBDb21tYW5kLlxyXG4gICAgICogQGFwaU5hbWUgcGF5Q29tbWFuZFxyXG4gICAgICogQGFwaUdyb3VwIENvbW1hbmRcclxuICAgICAqIEBhcGlQYXJhbSB7U3RyaW5nfSBjb21tYW5kX2lkIElkIG9mIGNvbW1hbmQuXHJcbiAgICAgKiBAYXBpUGFyYW0gKEF1dGhvcml6YXRpb24pe1N0cmluZ30gQmVhcmVyIFRva2VuIHZhbHVlIGluIGF1dGhvcmlzYXRpb24gQmVhcmVyLlxyXG4gICAgICogQGFwaVN1Y2Nlc3MgcmVzcG9uc2UgQ29tbWFuZCBwYWlkLlxyXG4gICAgICogQGFwaUVycm9yICg1MDIpIEVycm9yIEVycm9yIHRvIHJlcXVlc3QgZGF0YWJhc2UuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhc3luYyBwYXlDb21tYW5kICh7cmVxdWVzdCwgcmVzcG9uc2V9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xyXG4gICAgICAgIHRyeXtcclxuICAgICAgICAgICAgYXdhaXQgQ29tbWFuZC51cGRhdGVPbmUoe19pZDpyZXF1ZXN0LmlucHV0KCdjb21tYW5kX2lkJyl9LCB7cGFpZDp0cnVlfSkgXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5vayhcIkNvbW1hbmQgcGFpZFwiKSAgICAgIFxyXG4gICAgICAgIH1jYXRjaChlcnIpe1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMilcclxuICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAYXBpIHtwYXRjaH0gL3ZhbGlkYXRlIFZhbGlkYXRlIGEgQ29tbWFuZC5cclxuICAgICAgICAgKiBAYXBpTmFtZSB2YWxpZGF0ZUNvbW1hbmRcclxuICAgICAgICAgKiBAYXBpR3JvdXAgQ29tbWFuZFxyXG4gICAgICAgICAqIEBhcGlQYXJhbSB7U3RyaW5nfSBjb21tYW5kX2lkIElkIG9mIGNvbW1hbmQuXHJcbiAgICAgICAgICogQGFwaVBhcmFtIChBdXRob3JpemF0aW9uKXtTdHJpbmd9IEJlYXJlciBUb2tlbiB2YWx1ZSBpbiBhdXRob3Jpc2F0aW9uIEJlYXJlci5cclxuICAgICAgICAgKiBAYXBpU3VjY2VzcyByZXNwb25zZSBDb21tYW5kIHZhbGlkYXRlZC5cclxuICAgICAgICAgKiBAYXBpRXJyb3IgKDUwMikgRXJyb3IgRXJyb3IgdG8gcmVxdWVzdCBkYXRhYmFzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICAgcHVibGljIGFzeW5jIHZhbGlkYXRlQ29tbWFuZCAoe3JlcXVlc3QsIHJlc3BvbnNlfTpIdHRwQ29udGV4dENvbnRyYWN0KXtcclxuICAgICAgICAgICAgdHJ5e1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgQ29tbWFuZC51cGRhdGVPbmUoe19pZDpyZXF1ZXN0LmlucHV0KCdjb21tYW5kX2lkJyl9LCB7XCJpbmZvLnZhbGlkYXRlZFwiOnRydWV9KSBcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5vayhcIkNvbW1hbmQgdmFsaWRhdGVkXCIpICAgICAgXHJcbiAgICAgICAgICAgIH1jYXRjaChlcnIpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg1MDIpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgLyogICAgSGlzdG9yaWMgcmVxdWVzdHMgICAgKi9cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBhcGkge2dldH0gL2NvbW1hbmRzIEdldCBDb21tYW5kcyBvZiBhIHVzZXIuXHJcbiAgICAgKiBAYXBpTmFtZSBnZXRIaXN0b3JpY0NvbW1hbmRcclxuICAgICAqIEBhcGlHcm91cCBDb21tYW5kXHJcbiAgICAgKiBAYXBpUGFyYW0ge051bWJlcn0gY2xpZW50X2lkIElkIG9mIGNvbW1hbmQuXHJcbiAgICAgKiBAYXBpU3VjY2VzcyB7T2JqZWN0W119IGxpc3RfY29tbWFuZCBIaXN0b3JpYyBvZiBjb21tYW5kcy5cclxuICAgICAqIEBhcGlFcnJvciAoNTAyKSBFcnJvciBFcnJvciB0byByZXF1ZXN0IGRhdGFiYXNlLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYXN5bmMgZ2V0SGlzdG9yaWNDb21tYW5kICh7cmVxdWVzdCwgcmVzcG9uc2V9KXtcclxuICAgICAgICB0cnl7XHJcbiAgICAgICAgICAgIGNvbnN0IHRva2VuID0gcmVxdWVzdC5oZWFkZXIoJ2F1dGhvcml6YXRpb24nKS5zcGxpdChcIiBcIilcclxuICAgICAgICAgICAgY29uc3QgdXNlcl9pZD1qd3QudmVyaWZ5KHRva2VuWzFdLCBcIlRPS0VOX1BSSVZBVEVfS0VZXCIpLnVzZXJfaWRcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnNlbmQoYXdhaXQgQ29tbWFuZC5maW5kKHsnaW5mby5jbGllbnQudXNlcl9pZCc6dXNlcl9pZH0pKVxyXG4gICAgICAgIH1jYXRjaChlcnIpe1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMilcclxuICAgICAgICB9ICAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICBcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYXN5bmMgZ2V0Q29tbWFuZHMgKHtyZXNwb25zZX0pe1xyXG4gICAgICAgIHRyeXtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnNlbmQoYXdhaXQgQ29tbWFuZC5maW5kKCkpXHJcbiAgICAgICAgfWNhdGNoKGVycil7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAyKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICBwdWJsaWMgYXN5bmMgZ2V0Q29tbWFuZHNCeVJlc3RvcmVyICh7cmVxdWVzdCwgcmVzcG9uc2V9KXtcclxuICAgICAgICB0cnl7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3RvcmVyX2lkID0gcmVxdWVzdC5pbnB1dCgncmVzdG9yZXJfaWQnKVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc2VuZChhd2FpdCBDb21tYW5kLmZpbmQoeydpbmZvLnJlc3RvcmVyX2lkJzpyZXN0b3Jlcl9pZH0pKVxyXG4gICAgICAgIH1jYXRjaChlcnIpe1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMilcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAYXBpIHtkZWxldGV9IC9jb21tYW5kcyBEZWxldGUgQ29tbWFuZHMgaGlzdG9yaWMuXHJcbiAgICAgKiBAYXBpTmFtZSBkZWxldGVIaXN0b3JpY0NvbW1hbmRcclxuICAgICAqIEBhcGlHcm91cCBDb21tYW5kXHJcbiAgICAgKiBAYXBpUGFyYW0gKEF1dGhvcml6YXRpb24pe1N0cmluZ30gQmVhcmVyIFRva2VuIHZhbHVlIGluIGF1dGhvcmlzYXRpb24gQmVhcmVyLlxyXG4gICAgICogQGFwaVBhcmFtIChCb2R5KSB7U3RyaW5nW119IGxpc3RfY29tbWFuZF9pZCBMaXN0IG9mIGlkIG9mIGNvbW1hbmQuXHJcbiAgICAgKiBAYXBpU3VjY2VzcyByZXNwb25zZSBIaXN0b3JpYyBkZWxldGVkLlxyXG4gICAgICogQGFwaUVycm9yICg1MDIpIEVycm9yIEVycm9yIHRvIHJlcXVlc3QgZGF0YWJhc2UuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhc3luYyBkZWxldGVIaXN0b3JpY0NvbW1hbmQgKHtyZXF1ZXN0LCByZXNwb25zZX06SHR0cENvbnRleHRDb250cmFjdCl7XHJcbiAgICAgICAgdHJ5e1xyXG4gICAgICAgICAgICBhd2FpdCBDb21tYW5kLmRlbGV0ZU1hbnkoe19pZDogeyAkaW46IHJlcXVlc3QuYm9keSgpLmRlbGV0ZV9oaXN0b3JpY319KVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2soXCJDb21tYW5kcyBkZWxldGVkXCIpXHJcbiAgICAgICAgfWNhdGNoKGVycil7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAyKVxyXG4gICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICB9XHJcbn1cclxuIl19